<?xml version="1.0" encoding="UTF-8"?>
<!--
	Copyright (C) 2006 MindQuarry GmbH, All Rights Reserved
-->
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

	<!-- DFORMS -->

	<map:components>
		<map:actions>
			<map:action name="log"
				src="com.mindquarry.webapp.acting.DebugLogAction" />
		</map:actions>
	</map:components>

	<map:resources>
		<map:resource name="directories2model">
			<map:transform src="xsl/model/wrap-as-model.xsl" />
			<map:transform type="include" />
			<map:serialize type="xml" />
		</map:resource>
	</map:resources>

	<map:pipelines>
		<map:pipeline type="noncaching">

			<map:match pattern="model.xml">
				<map:act type="log" src=">>[dforms] model.xml" />
				
				<map:generate src="block:/dforms-model-directory.xml" />
				<map:call resource="directories2model" />
			</map:match>

			<!-- @virtual: getting basic model stuff -->
			<map:match pattern="dforms-model-directory.xml">
				<map:act type="log" src=">>[dforms] dforms-model-directory.xml" />
				
				<map:generate src="model" type="directory" />
				<!-- Note: for some reason the generic
				     src="block:/directory2resourceincludes.xsl" reference
				     does not work here -->
				<map:transform src="xsl/directory2resourceincludes.xsl" />
				<map:serialize type="xml" />
			</map:match>

			<!-- for child blocks to create includes of files in directories
				 with the correct block:/resource/* source format -->
			<map:match pattern="directory2resourceincludes.xsl">
				<map:act type="log" src=">>[dforms] directory2resourceincludes.xsl" />
			
				<map:read src="xsl/directory2resourceincludes.xsl" />
			</map:match>

			<!-- @virtual: for inheriting sitemap resources -->
			<map:match pattern="resource/**">
				<map:act type="log" src=">>[dforms] resource/**" />
				
				<map:read src="{1}" />
			</map:match>

		</map:pipeline>

	</map:pipelines>

</map:sitemap>

