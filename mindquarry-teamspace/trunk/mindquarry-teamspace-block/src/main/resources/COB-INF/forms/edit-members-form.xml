<fd:form xmlns:fd="http://apache.org/cocoon/forms/1.0#definition">
	<fd:widgets>
		<fd:output id="teamspaceName">
			<fd:datatype base="string" />
		</fd:output>
				
		<fd:group id="editMembersModel" state="invisible">
			<fd:widgets>

				<fd:repeater id="members">
					<fd:label>Members</fd:label>
					<fd:widgets>
						<fd:output id="userId">
							<fd:datatype base="string" />
						</fd:output>
						<fd:output id="name">
							<fd:datatype base="string" />
						</fd:output>
						<fd:row-action id="removeMember" command="delete">
							<fd:label>remove member</fd:label>
							<fd:on-action>
								<fd:javascript>
									removeMember(event);
								</fd:javascript>
							</fd:on-action>
						</fd:row-action>
					</fd:widgets>
				</fd:repeater>

				<fd:repeater id="nonMembers">
					<fd:label>Non Members</fd:label>
					<fd:widgets>
						<fd:output id="userId">
							<fd:datatype base="string" />
						</fd:output>
						<fd:output id="name">
							<fd:datatype base="string" />
						</fd:output>
						<fd:row-action id="addMember" command="delete">
							<fd:label>add member</fd:label>
							<fd:on-action>
								<fd:javascript>
									addMember(event);
								</fd:javascript>
							</fd:on-action>
						</fd:row-action>
					</fd:widgets>
				</fd:repeater>

				<fd:submit id="ok">
					<fd:label>ok</fd:label>
					<fd:on-action>
						<fd:javascript>
							saveMembershipChanges(event);
						</fd:javascript>
					</fd:on-action>
				</fd:submit>

				<fd:submit id="cancel" validate="false">
					<fd:label>cancel</fd:label>
				</fd:submit>

				<fd:action id="createUser">
					<fd:label>create new member</fd:label>
					<fd:on-action>
						<fd:javascript>
							activateCreateUserForm();
						</fd:javascript>
					</fd:on-action>
				</fd:action>
			</fd:widgets>
		</fd:group>


		<fd:group id="createUserModel" state="invisible">
			<fd:widgets>
				<fd:field id="userId" required="true">
					<fd:label>user ID</fd:label>
					<fd:datatype base="string"></fd:datatype>
					<fd:validation>
						<fd:regexp pattern="[\w]{3,}">
							<fd:failmessage>
								invalid user id; it must contains 
								(at least 3) word characters
							</fd:failmessage>
						</fd:regexp>
					</fd:validation>
				</fd:field>
				<fd:field id="name" required="true">
					<fd:label>full name</fd:label>
					<fd:datatype base="string"></fd:datatype>
					<fd:validation>
						<fd:regexp pattern="[\w\s]+">
							<fd:failmessage>
								invalid full name; it must contains at
								least one word character
							</fd:failmessage>
						</fd:regexp>
					</fd:validation>
				</fd:field>
				<fd:field id="email" required="true">
					<fd:label>email</fd:label>
					<fd:datatype base="string"></fd:datatype>
					<fd:validation>
						<fd:email>
							<fd:failmessage>
								Not a valid email address!
							</fd:failmessage>
						</fd:email>
					</fd:validation>
				</fd:field>

				<fd:submit id="createUserSubmit" state="invisible">
					<fd:label>create user</fd:label>
					<fd:on-action>
						<fd:javascript>
							createUser();
						</fd:javascript>
					</fd:on-action>
				</fd:submit>

				<fd:submit id="cancelSubmit" state="invisible" validate="false">
					<fd:label>cancel (and return)</fd:label>
				</fd:submit>
				
				
				<fd:action id="createUserAction" state="invisible">
					<fd:label>create user</fd:label>
					<fd:on-action>
						<fd:javascript>
							var user = createUser();
							addUserToMembers(user);
							activateEditMembersForm();
						</fd:javascript>
					</fd:on-action>
				</fd:action>
				
				<fd:action id="cancelAction" state="invisible">
					<fd:label>cancel</fd:label>
					<fd:on-action>
						<fd:javascript>
							activateEditMembersForm();
						</fd:javascript>
					</fd:on-action>
				</fd:action>
			</fd:widgets>
		</fd:group>
	</fd:widgets>
</fd:form>