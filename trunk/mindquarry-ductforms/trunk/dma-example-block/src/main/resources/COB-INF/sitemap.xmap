<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright (C) 2005 MindQuarry GmbH, All Rights Reserved -->

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
  
  <map:components>
  	<map:generators default="dma">
		<map:generator name="dma"
                src="org.apache.cocoon.generation.TraversableSourceDescriptionGenerator"
                label="content"/>
        <map:generator name="changelog"
                src="com.mindquarry.dma.generator.ChangeLogGenerator"/>
        <!-- map:generator name="changelog"
                src="com.mindquarry.dma.generator.ChangeLogGenerator"
                label="content"/-->
  	</map:generators>
  </map:components>
  
  <map:pipelines>
  	<!-- use noncaching pipeline -->
    <map:pipeline type="noncaching">
    
      <!-- repository listing -->
      <map:match pattern="">
      	<map:generate type="dma" src="file://{system-property:user.dir}/src/main/resources/COB-INF/repos"/>
      	<map:transform src="xslt/file/dir2html.xsl" /> 
      	<map:serialize type="html"/>
      </map:match>
      
      <!-- debug output -->
      <map:match pattern="debug/**">
		<map:generate type="dma" src="dma:file://{system-property:user.dir}/src/main/resources/COB-INF/repos/{1}" />
		<map:serialize type="xml"/>
      </map:match>
      
      <!-- icons from tango jar -->
      <map:match pattern="icons/*/folder.png">
      	<map:read src="resource://org/tango-project/tango-icon-theme/{1}/places/folder.png" />
      </map:match>
      
      <map:match pattern="icons/*/feed.png">
      	<map:read src="icons/feed-icon-{1}.png" />
      </map:match>
      
      <map:match pattern="icons/*/application/pdf.png">
      	<map:read src="resource://org/tango-project/tango-icon-theme/{1}/mimetypes/x-office-document.png" />
      </map:match>
      
      <map:match pattern="icons/*/actions/*.png">
      	<map:read src="resource://org/tango-project/tango-icon-theme/{1}/actions/{2}.png" />
      </map:match>
      
      <map:match pattern="icons/*/text/html.png">
      	<map:read src="resource://org/tango-project/tango-icon-theme/{1}/mimetypes/x-office-document.png" />
      </map:match>
      
      <map:match pattern="icons/*/text/*.png">
      	<map:read src="resource://org/tango-project/tango-icon-theme/{1}/mimetypes/text-x-generic.png" />
      </map:match>
      
      <map:match pattern="icons/*/image/*.png">
      	<map:read src="resource://org/tango-project/tango-icon-theme/{1}/mimetypes/image-x-generic.png" />
      </map:match>
      
      <map:match pattern="icons/*/*/*.png">
      	<map:read src="resource://org/tango-project/tango-icon-theme/{1}/mimetypes/x-office-document.png" />
      </map:match>
      
 
     <!-- directr -->  
      <map:match pattern="(\d+)/(\w+)(.*)/$" type="regexp">
		<map:generate type="dma" src="dma:file://{system-property:user.dir}/src/main/resources/COB-INF/repos/{2}/{3}?revision={1}" />
		<map:transform src="xslt/dma/dir2html.xsl">
			<map:parameter name="revision" value="{1}"/>
			<map:parameter name="repo" value="{2}"/>
			<map:parameter name="path" value="{3}/"/>
		</map:transform>
		<map:serialize type="html"/>
      </map:match>
      
      <map:match pattern="(\w+)(.*)/$" type="regexp">
      	<map:select type="request-parameter">
      		<map:parameter name="parameter-name" value="show"/>
      		<map:when test="xml">
      			<map:generate type="changelog" src="dma:file://{system-property:user.dir}/src/main/resources/COB-INF/repos/{1}/{2}" >
      				<map:parameter name="revision" value="1"/>
      			</map:generate>
      			<map:serialize type="xml"/>
      		</map:when>
      		<map:when test="atom">
      			<map:generate type="changelog" src="dma:file://{system-property:user.dir}/src/main/resources/COB-INF/repos/{1}/{2}" >
      				<map:parameter name="revision" value="1"/>
      				<map:parameter name="entries" value="10" />
      			</map:generate>
      			<map:transform src="xslt/log/log2atom.xsl" />
      			<map:serialize type="xml"/>
      		</map:when>
      		<map:when test="changes">
      			<map:generate type="changelog" src="dma:file://{system-property:user.dir}/src/main/resources/COB-INF/repos/{1}/{2}" >
      				<map:parameter name="revision" value="1"/>
      				<map:parameter name="entries" value="10" />
      			</map:generate>
      			<map:transform src="xslt/log/log2html.xsl" />
      			<map:serialize type="html"/>
      		</map:when>
      		<map:otherwise>
      			<map:generate type="dma" src="dma:file://{system-property:user.dir}/src/main/resources/COB-INF/repos/{1}/{2}" />
				<map:transform src="xslt/dma/dir2html.xsl">
					<map:parameter name="repo" value="{1}"/>
					<map:parameter name="path" value="{2}/"/>
				</map:transform>
				<map:serialize type="html"/>
      		</map:otherwise>
      	</map:select>
      </map:match>
      
      <map:match pattern="(\d+)/(\w+)(.*)$" type="regexp">
      	<map:read src="dma:file://{system-property:user.dir}/src/main/resources/COB-INF/repos/{2}/{3}?revision={1}" />
      </map:match>
      
      <map:match pattern="(\w+)(.*)$" type="regexp">
      	<map:read src="dma:file://{system-property:user.dir}/src/main/resources/COB-INF/repos/{1}/{2}" />
      </map:match>

      <!-- 
      <map:match pattern="**">
      	<map:read src="dma:file://{system-property:user.dir}/src/main/resources/COB-INF/repos/{1}" />
      </map:match>
       -->
       
       
       
       <map:handle-errors>
          <map:generate type="exception"/>
          <map:serialize status-code="500" type="xml"/>
    </map:handle-errors>
       
    </map:pipeline>
    
  </map:pipelines>
  
</map:sitemap>

<!-- map:read src="dma:http://svn.collab.net/repos/svn/trunk/subversion/bindings/java/javahl/src/org/tigris/subversion/javahl/tests/SVNTests.java"/-->
