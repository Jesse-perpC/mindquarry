<?xml version="1.0" encoding="UTF-8"?>
<!--
	Copyright (C) 2006 MindQuarry GmbH, All Rights Reserved
-->
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

	<!-- TASKS -->

	<map:components>
		<map:actions>
			<map:action name="log"
				src="com.mindquarry.webapp.acting.DebugLogAction" />
			<map:action name="log-params"
				src="com.mindquarry.webapp.acting.LogParametersAction" />
		</map:actions>
	</map:components>

	<map:pipelines>
		<!-- <map:pipeline type="noncaching">
			<map:match pattern="xslt/*.xsl">
			<map:select type="resource-exists">
			<map:when test="xsl/{1}.xsl">
			<map:read
			src="xsl/{1}.xsl" />
			</map:when>
			<map:otherwise>
			<map:read src="block:super:/xslt/{1}.xsl" />
			</map:otherwise>
			</map:select>
			</map:match>	
			</map:pipeline> -->

		<map:pipeline type="noncaching">

			<!-- @virtual: for even more specific sub-blocks ;-) -->
			<map:match pattern="tasks-dforms-model-directory.xml">
				<map:generate src="dforms-model" type="directory" />
				<map:transform
					src="block:super:/directory2resourceincludes.xsl" />
				<map:serialize type="xml" />
			</map:match>

			<!-- @override: provide the model as directory listing for the dforms block -->
			<map:match pattern="dforms-model-directory.xml">
				<!-- we want our models and the inherited models -->
				<map:aggregate element="resources">
					<map:part
						src="block:super:/dforms-model-directory.xml" />
					<map:part
						src="block:/tasks-dforms-model-directory.xml" />
				</map:aggregate>
				<map:serialize type="xml" />
			</map:match>

			<!-- public -->

			<!--+
				| URL for a task in a certain teamspace:
				| .../tasks/<teamspace-id>/<task-id>.xml
				|
				| JCR path for the task:
				| /teamspaces/<teamspace-id>/tasks/<task-id>.xml
				+-->
			<map:match pattern="*/*.xml">
				<map:read
					src="block:super:/show-document.xml?baseURI={url-encode:jcr:///teamspaces/{1}/tasks/}&amp;documentID={url-encode:{2}}" />
			</map:match>
			
			<map:match pattern="*/*.xml.edit">
				<map:read
					src="block:super:/edit-document.xml?baseURI={url-encode:jcr:///teamspaces/{1}/tasks/}&amp;documentID={url-encode:{2}}" />			
			</map:match>


			<!-- =========================================================== -->

			<!-- @override: for inheriting sitemap resources -->
			<map:match pattern="resource/**">
				<map:select type="resource-exists">
					<!-- if it exists, load it from this sitemap's resources -->
					<map:when test="{1}">
						<map:read src="{1}" />
					</map:when>
					<!-- if not, look in the super block -->
					<map:otherwise>
						<map:read src="block:super:/resource/{1}" />
					</map:otherwise>
				</map:select>
			</map:match>

			<map:match pattern="*/*.continue">
				<map:act type="log-params" />
				<map:read src="block:super:/{2}.continue?{params-as-uri:request-param}" />
			</map:match>

			<!--+
				| forward any unknown stuff to the super block 
				| NOTE: This must be the last matcher!
				+-->
			<map:match pattern="**">
				<map:read src="block:super:/{1}" />
			</map:match>

		</map:pipeline>
	</map:pipelines>

</map:sitemap>

