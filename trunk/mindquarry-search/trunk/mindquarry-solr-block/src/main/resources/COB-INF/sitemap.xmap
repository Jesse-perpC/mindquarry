<?xml version="1.0" encoding="UTF-8"?>
<!--
	Copyright (C) 2006 MindQuarry GmbH, All Rights Reserved
-->
<sitemap xmlns="http://apache.org/cocoon/sitemap/1.0">
	<components>
		<actions>
			<action name="log" src="com.mindquarry.webapp.acting.DebugLogAction"/>
			<action name="log-params" src="com.mindquarry.webapp.acting.LogParametersAction"/>
			<action name="authorise" src="com.mindquarry.webapp.acting.AuthorisationAction"/>
		</actions>

		<selectors>
			<selector name="request-method" logger="sitemap.selector.request-method"
				src="org.apache.cocoon.selection.RequestMethodSelector"/>
		</selectors>
	</components>

	<pipelines>
		<pipeline type="noncaching">
			<match pattern="admin/*.jsp">
				<read src="admin/{1}.jsp" type="jsp"/>
			</match>

			<match pattern="admin/*.png">
				<read src="admin/{1}.png"/>
			</match>

			<match pattern="admin/*.gif">
				<read src="admin/{1}.gif"/>
			</match>

			<match pattern="admin/*.css">
				<read src="admin/{1}.css"/>
			</match>

			<match pattern="html/*.html">
				<read src="html/{1}.html"/>
			</match>
		</pipeline>

		<pipeline type="noncaching">
			<match pattern="update">
				<act type="log" src="0"/>

				<select type="request-method">
					<when test="POST">
						<act type="log" src="1"/>
						<generate type="stream">
							<parameter name="defaultContentType" value="text/xml"/>
						</generate>

						<act type="log" src="2"/>
						<transform src="xslt/xml/list2solr.xsl"/>

						<act type="log" src="3"/>
						<serialize type="xml"/>
					</when>
					<otherwise>
						<read src="html/only-POST-allowed.html"/>
					</otherwise>
				</select>
			</match>

			<match pattern="">
				<redirect-to uri="{block-path:}/admin/index.jsp"/>
			</match>
		</pipeline>
	</pipelines>
</sitemap>
