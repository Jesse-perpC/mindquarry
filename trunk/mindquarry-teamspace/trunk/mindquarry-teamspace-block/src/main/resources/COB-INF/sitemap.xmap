<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright (C) 2005 MindQuarry GmbH, All Rights Reserved -->

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
	<map:components>
		<map:actions>
			<map:action name="setnohttpcache"
				src="org.apache.cocoon.acting.HttpCacheAction">
				<seconds>0</seconds>
			</map:action>
		</map:actions>
	</map:components>
	
	<map:flow language="javascript">
		<map:script src="admin.js" />
    	<map:script src="teamspace-view.js"/>
	</map:flow>
	
	<map:pipelines>

		<!-- use noncaching pipeline -->
		<map:pipeline type="noncaching">
			<map:match pattern="">
				<map:call function="teamspaceView" />
			</map:match>
			<map:match pattern="screens/teamspaceView">
				<map:generate src="teamspace-view.jx" type="jx" />
				<map:transform src="xslt/teamspaces2html.xsl"/>
				<map:serialize type="html" />
			</map:match>
		</map:pipeline>

		<!-- use noncaching pipeline -->
		<map:pipeline type="noncaching">

			<!-- repository listing -->
			<map:match pattern="admin">
				<map:call function="handleForm">
					<map:parameter name="function"
						value="manageProjects" />
					<map:parameter name="definitionURI"
						value="forms/admin-form.xml" />
				</map:call>
			</map:match>

			<map:match pattern="*.instance">
				<map:generate type="jx" src="forms/{1}-template.xml"
					label="content1">
					<map:parameter name="locale"
						value="{flow-attribute:locale}" />
				</map:generate>

				<map:transform src="xslt/forms/form2html.xsl">
					<map:parameter name="resources-uri"
						value="{request:contextPath}/_cocoon/resources" />
				</map:transform>
				<map:serialize type="html" />
			</map:match>


			<map:match pattern="resources/*/**">
				<map:read src="{1}/{2}" />
			</map:match>

			<!-- Continue a scenario. The continuation id is passed in the URL
				(typically used for GET requests) -->
			<map:match pattern="*.continue">
				<map:act type="setnohttpcache" />
				<map:call continuation="{1}" />
			</map:match>
		</map:pipeline>

	</map:pipelines>

</map:sitemap>